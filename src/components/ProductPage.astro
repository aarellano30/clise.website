---
import { Image } from 'astro:assets';
import { render, getEntry } from 'astro:content';
import { useTranslations, getLocalePath } from '../i18n/utils';
import type { Locale } from '../i18n/utils';
import type { CollectionEntry } from 'astro:content';

interface Props {
	entry: CollectionEntry<'products'>;
}

const { entry } = Astro.props;
const lang = (Astro.currentLocale || 'es') as Locale;
const t = useTranslations(lang);

const { name, description, applications, finishes, industries } = entry.data;
const slug = entry.id.replace(`${lang}/`, '');
const assets = await getEntry('productAssets', slug);
const image1 = assets?.data.featuredImage1;
const image2 = assets?.data.featuredImage2;
const gallery = assets?.data.gallery ?? [];
const { Content } = await render(entry);

const productsPath = getLocalePath(lang, 'products');
const contactPath = getLocalePath(lang, 'contact');
---

<div class="bg-gray-900">
	<div class="mx-auto max-w-7xl px-6 py-16 sm:py-24 lg:px-8">
		<!-- Back link -->
		<a href={productsPath} class="inline-flex items-center text-sm font-medium text-gray-400 hover:text-white transition-colors">
			<svg class="mr-2 size-4" viewBox="0 0 20 20" fill="currentColor">
				<path fill-rule="evenodd" d="M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z" clip-rule="evenodd" />
			</svg>
			{t('products.backToProducts')}
		</a>

		<!-- Hero: Name | Description -->
		<div class="mt-8 grid gap-8 lg:grid-cols-2 lg:items-start">
			<h1 class="fade-in text-4xl font-semibold tracking-tight text-white sm:text-5xl lg:text-6xl">
				{name}
			</h1>
			<p class="fade-in fade-in-delay-100 text-lg/8 text-gray-300">
				{description}
			</p>
		</div>

		<!-- Featured Images -->
		<div class="mt-12 grid grid-cols-1 gap-6 sm:grid-cols-2">
			<div class="fade-in overflow-hidden rounded-2xl ring-1 ring-white/10">
				{image1 ? (
					<Image src={image1} alt={name} widths={[400, 800]} sizes="(max-width: 640px) 100vw, 50vw" class="h-full w-full object-cover aspect-[4/3]" />
				) : (
					<div class="flex aspect-[4/3] items-center justify-center bg-gray-800 text-gray-500">
						<svg class="size-16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
							<path d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909M3.75 21h16.5A2.25 2.25 0 0 0 22.5 18.75V5.25A2.25 2.25 0 0 0 20.25 3H3.75A2.25 2.25 0 0 0 1.5 5.25v13.5A2.25 2.25 0 0 0 3.75 21Z" stroke-linecap="round" stroke-linejoin="round" />
						</svg>
					</div>
				)}
			</div>
			<div class="fade-in fade-in-delay-100 overflow-hidden rounded-2xl ring-1 ring-white/10">
				{image2 ? (
					<Image src={image2} alt={`${name} - 2`} widths={[400, 800]} sizes="(max-width: 640px) 100vw, 50vw" class="h-full w-full object-cover aspect-[4/3]" />
				) : (
					<div class="flex aspect-[4/3] items-center justify-center bg-gray-800 text-gray-500">
						<svg class="size-16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
							<path d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909M3.75 21h16.5A2.25 2.25 0 0 0 22.5 18.75V5.25A2.25 2.25 0 0 0 20.25 3H3.75A2.25 2.25 0 0 0 1.5 5.25v13.5A2.25 2.25 0 0 0 3.75 21Z" stroke-linecap="round" stroke-linejoin="round" />
						</svg>
					</div>
				)}
			</div>
		</div>

		<!-- Badges -->
		<div class="fade-in fade-in-delay-200 mt-12 grid gap-8 sm:grid-cols-3">
			<div>
				<h3 class="flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-gray-400">
					<svg class="size-7 text-slate-600" viewBox="0 0 24 24" fill="currentColor">
						<path d="m10.2,3.18c-3.52.68-6.34,3.51-7.02,7.02-.96,4.94,2.11,9.6,6.99,10.61.24.05.48.07.71.07.92,0,1.81-.36,2.48-1.03l6.5-6.5c.84-.84,1.2-2.03.96-3.19-1.01-4.88-5.67-7.95-10.61-6.99Zm.17,16.66c-4.34-.9-7.06-5.05-6.21-9.44.61-3.12,3.11-5.63,6.23-6.23.54-.11,1.08-.16,1.61-.16,3.76,0,7.04,2.57,7.83,6.37.05.23.06.46.04.69-.83-.09-1.68-.06-2.49.11-.51.11-1.02.26-1.5.47-.47.2-.93.45-1.36.74-.43.29-.82.62-1.18.97s-.69.75-.98,1.18c-.29.43-.53.88-.74,1.36-.2.48-.36.99-.47,1.5-.11.53-.16,1.07-.16,1.61,0,.29.02.59.05.88-.23.02-.46,0-.69-.04Z" />
					</svg>
					{t('products.applications')}
				</h3>
				<div class="mt-3 flex flex-wrap gap-2">
					{applications.map((app) => (
						<span class="inline-flex items-center rounded-full bg-slate-500/10 px-3 py-1 text-sm text-slate-400 ring-1 ring-slate-500/20">
							{app}
						</span>
					))}
				</div>
			</div>
			<div>
				<h3 class="flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-gray-400">
					<svg class="size-7 text-rose-700" viewBox="0 0 24 24" fill="currentColor">
						<path opacity="0.4" d="m20.59,5.09l-.24-.11c-.5-.23-1.1-.82-1.32-1.32l-.11-.24c-.23-.5-.6-.5-.83,0l-.11.24c-.23.5-.82,1.1-1.32,1.32l-.24.11c-.5.23-.5.6,0,.83l.24.11c.5.23,1.1.82,1.32,1.32l.11.24c.23.5.6.5.83,0l.11-.24c.23-.5.82-1.1,1.32-1.32l.24-.11c.5-.23.5-.6,0-.83Z" />
						<path d="m19.97,12.93c.39-.15.64-.52.64-.93s-.25-.78-.64-.93l-3.21-1.24c-1.19-.46-2.13-1.4-2.58-2.58l-1.24-3.21c-.15-.39-.52-.64-.93-.64s-.78.25-.93.64h0l-1.24,3.21c-.46,1.19-1.4,2.13-2.58,2.58l-3.21,1.24c-.39.15-.64.52-.64.93s.25.78.64.93l3.21,1.24c1.19.46,2.13,1.4,2.58,2.58l1.24,3.21c.15.39.52.64.93.64s.78-.25.93-.64l1.24-3.21c.46-1.19,1.4-2.13,2.58-2.58l3.21-1.24Zm-6.73,3.46l-1.24,3.21-1.24-3.21c-.56-1.45-1.71-2.6-3.16-3.16l-3.21-1.24,3.21-1.24c1.45-.56,2.6-1.71,3.16-3.16l1.24-3.21,1.24,3.21c.56,1.45,1.71,2.6,3.16,3.16l3.21,1.24-3.21,1.24c-1.45.56-2.6,1.71-3.16,3.16Z" />
					</svg>
					{t('products.finishes')}
				</h3>
				<div class="mt-3 flex flex-wrap gap-2">
					{finishes.map((finish) => (
						<span class="inline-flex items-center rounded-full bg-rose-500/10 px-3 py-1 text-sm text-rose-400 ring-1 ring-rose-500/20">
							{finish}
						</span>
					))}
				</div>
			</div>
			<div>
				<h3 class="flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-gray-400">
					<svg class="size-7 text-cyan-700" viewBox="0 0 24 24" fill="currentColor">
						<path d="m19.75,5.08c-.56-1.26-1.82-2.08-3.2-2.08H7.45c-1.38,0-2.64.82-3.2,2.08l-1.08,2.43c-.11.26-.17.53-.17.81v1.06c0,.84.4,1.58,1.01,2.06,0,.02-.01.04-.01.07v6c0,1.93,1.57,3.5,3.5,3.5h9c1.93,0,3.5-1.57,3.5-3.5v-6s-.01-.05-.01-.07c.61-.48,1.01-1.22,1.01-2.06v-1.06c0-.28-.06-.56-.17-.81l-1.08-2.43Zm-7.25-1.08h2.12l1.13,4.07v1.31c0,.9-.73,1.62-1.62,1.62s-1.62-.73-1.62-1.62v-5.38Zm-1,0v5.38c0,.9-.73,1.62-1.62,1.62s-1.62-.73-1.62-1.62v-1.31l1.13-4.07h2.12Zm-7.5,4.32c0-.14.03-.28.09-.41l1.08-2.43c.4-.9,1.3-1.48,2.28-1.48h.89l-1.07,3.87-.02,1.51c0,.9-.73,1.62-1.62,1.62s-1.62-.73-1.62-1.62v-1.06Zm6,11.68v-3c0-1.1.9-2,2-2s2,.9,2,2v3h-4Zm9-2.5c0,1.38-1.12,2.5-2.5,2.5h-1.5v-3c0-1.65-1.35-3-3-3s-3,1.35-3,3v3h-1.5c-1.38,0-2.5-1.12-2.5-2.5v-5.58c.2.05.41.08.62.08.88,0,1.65-.44,2.12-1.1.48.66,1.25,1.1,2.12,1.1s1.65-.44,2.12-1.1c.48.66,1.25,1.1,2.12,1.1s1.65-.44,2.12-1.1c.48.66,1.25,1.1,2.12,1.1.22,0,.42-.03.62-.08v5.58Zm1-8.12c0,.9-.73,1.62-1.62,1.62s-1.62-.73-1.62-1.62v-1.38l-1.09-4h.89c.99,0,1.88.58,2.28,1.48l1.08,2.43c.06.13.09.26.09.41v1.06Z" />
					</svg>
					{t('products.industries')}
				</h3>
				<div class="mt-3 flex flex-wrap gap-2">
					{industries.map((industry) => (
						<span class="inline-flex items-center rounded-full bg-cyan-500/10 px-3 py-1 text-sm text-cyan-400 ring-1 ring-cyan-500/20">
							{industry}
						</span>
					))}
				</div>
			</div>
		</div>

		<!-- Gallery -->
		{gallery.length > 0 && (
			<div class="fade-in mt-16 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
				{gallery.map((src, i) => (
					<div class="overflow-hidden rounded-xl ring-1 ring-white/10">
						<Image src={src} alt={`${name} - ${i + 1}`} widths={[300, 600]} sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 25vw" class="h-full w-full object-cover aspect-[4/3]" loading="lazy" />
					</div>
				))}
			</div>
		)}

		<!-- Markdown body -->
		<div class="fade-in fade-in-delay-300 mx-auto mt-16 max-w-3xl">
			<div class="prose prose-invert prose-lg prose-indigo max-w-none prose-headings:font-semibold prose-a:text-indigo-400">
				<Content />
			</div>
		</div>

		<!-- CTA -->
		<div class="mt-16 text-center">
			<a
				href={contactPath}
				class="inline-flex items-center rounded-md bg-indigo-800 px-6 py-3 text-base font-medium text-white hover:bg-indigo-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-800 transition-colors"
			>
				{t('products.contactCta')}
			</a>
		</div>
	</div>
</div>
